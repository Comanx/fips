<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Cross-Compiling</title>
  <meta name="description" content="cmake-based high-level build system for multi-platform C/C++ projects
">

  <link rel="stylesheet" href="/fips/css/main.css">
  <link rel="canonical" href="http://floooh.github.com/fips/crosscompiling.html">
</head>


  <body>

    <header class="site-header">

    <!-- this is the 'fork me on github' label -->
    <a href="https://github.com/floooh/fips"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

    <div class="site-title">
        fips
        <span class="site-subtitle">the friendly cmake wrapper</span>
    </div>
</header>




    <ul class="navigation">
    
        
        <li class="nav-item">
            <a href="/fips/index.html">About Fips</a>
        </li>
        
    
        
    
        
        <li class="nav-item">
            <a href="/fips/getstarted.html">Get Started</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/build.html">Build Projects</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/troubleshooting.html">Troubleshooting</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/crosscompiling.html">Cross-Compiling</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/cmakeguide.html">CMake Guide</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/imports.html">Imports</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/exports.html">Exports</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/codegen.html">Code Generation</a>
        </li>
        
    
        
        <li class="nav-item">
            <a href="/fips/dirstruct.html">Directory Structure</a>
        </li>
        
    
</ul>



    <div class="page-content">
        <div>

  <article>
    <h1 id="cross-compiling">Cross-Compiling</h1>

<p>Fips provides easy cross-compiling support to the following platforms:</p>

<ul>
  <li><strong>iOS</strong></li>
  <li><a href="https://developer.android.com/tools/sdk/ndk/index.html"><strong>Android</strong></a></li>
  <li><a href="http://kripken.github.io/emscripten-site/index.html"><strong>emscripten</strong></a></li>
  <li><a href="https://developer.chrome.com/native-client"><strong>PNaCl</strong></a></li>
</ul>

<p>Cross-compilation to iOS is only supported on the OSX host platform. All
other target platforms are supported on all 3 host platforms (OSX, Linux, Windows).</p>

<h3 id="setting-up-the-platform-sdks">Setting up the platform SDKs</h3>

<p>Fips provides simple commands to setup the SDKs for Android, emscripten and
PNaCl:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips setup emscripten
<span class="o">&gt;</span> ./fips setup nacl
<span class="o">&gt;</span> ./fips setup android</code></pre></figure>

<p>This will download, unpack and setup the respective SDKs into a directory
<em>fips-sdks</em> next to the fips directory.</p>

<blockquote>
  <p>NOTE: there is currently no way to use an SDK installed to another location</p>
</blockquote>

<p>You should also run ‘fips diag tools’ to make sure that all required
tools are in the path:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips diag tools
...</code></pre></figure>

<h3 id="testing-cross-compilation">Testing cross-compilation</h3>

<p>Cross-compilation requires a portable code base, in the case of Android and
PNaCl this is a bit non-trivial (e.g. the canonical C ‘Hello World’ doesn’t
work). Let’s use the Oryol 3D engine for testing:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips clone oryol
<span class="o">&gt;</span> <span class="nb">cd</span> ../oryol</code></pre></figure>

<p>First let’s try whether <strong>emscripten</strong> compilation works:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips <span class="nb">set </span>config emsc-make-release
<span class="o">&gt;</span> ./fips build
...
<span class="o">&gt;</span> ./fips run Triangle</code></pre></figure>

<p>The last command should open the default web browser and a local http server.
It may be necessary to refresh the page in case the http server needs too long
to start.</p>

<p>Cross-compiling to <strong>PNaCl</strong> is just as easy, just use a different config:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips <span class="nb">set </span>config pnacl-make-release
<span class="o">&gt;</span> ./fips build
...
<span class="o">&gt;</span> ./fips run Triangle</code></pre></figure>

<p>Same for <strong>Android</strong>, note that Android provides 3 types of config, one for each
CPU type.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips build android-make-release
<span class="o">&gt;</span> ./fips build androidx86-make-release
<span class="o">&gt;</span> ./fips build androidmips-make-release

<span class="o">&gt;</span> NOTE: Android MIPS is not yet fully supported on Oryol!</code></pre></figure>

<p>Finally iOS: this works a bit differently since iOS compiling and debugging
works best directly in Xcode. Instead of a command line build, we only 
generate the Xcode project files, and then start Xcode:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;</span> ./fips <span class="nb">set </span>config ios-xcode-debug
<span class="o">&gt;</span> ./fips <span class="nb">set </span>iosteam XYZW123456
<span class="o">&gt;</span> ./fips gen
<span class="o">&gt;</span> ./fips open</code></pre></figure>

<p>Note the <strong>./fips set iosteam XYZW123456</strong> before the first call to <strong>./fips gen</strong>.
This sets the <em>iOS Development Team ID</em> for each target in the Xcode project,
so you don’t need to do this manually each time you generate the solution.
The team id will be written to the local file <em>.fips-settings.yml</em> in the project
directory, so you only need to do this once before the first <strong>./fips gen</strong>.</p>

<p>You can lookup your team id on the Apple Developer web site:
https://developer.apple.com/account/#/membership</p>

<p>Once in Xcode, the samples can be compiled and debugged either in the simulator
or on a real device (provided Xcode is properly setup for iOS development).</p>

<h3 id="under-the-hood">Under the hood</h3>

<p>Cross-compiling currently has a few caveats:</p>

<ul>
  <li>it is currently not possible to use existing SDKs in other filesystem locations</li>
  <li>the <em>emscripten</em> SDK always uses the <em>incoming</em> branch, not the <em>master</em> branch</li>
  <li>the NaCl SDK currently always uses the pepper_canary API version</li>
  <li>for Android, ‘universal binaries’ containing ARM, X86 and MIPS binaries are 
currently not supported</li>
</ul>

<p>Cross-compiling build settings are defined in cmake toolchain files in:</p>

<ul>
  <li>fips/cmake-toolchains/android.toolchain.cmake</li>
  <li>fips/cmake-toolchains/emscripten.toolchain.cmake</li>
  <li>fips/cmake-toolchains/ios.toolchain.cmake</li>
  <li>fips/cmake-toolchains/pnacl.toolchain.cmake</li>
</ul>

<p>Fips projects can override these standard toolchain files, or define
completely new toolchain files, by creating
a directory named ‘fips-files/toolchains’ in the project root directory, and
placing cmake toolchain files there.</p>

<p>Fips will search for toolchain files in the following order:</p>

<ul>
  <li>first in the current project</li>
  <li>then in imported projects</li>
  <li>finally in the fips directory</li>
</ul>

<p>With this search order, fips projects can either override fips’ standard
toolchain files, or toolchain files provided by imported projects.</p>

<p>Fips build configs can support completely new platforms by setting the
<strong>cmake-toolchain</strong> attribute to the name of a custom toolchain file.</p>

<p>For some target platforms, cmake generates additional files during the cmake run:</p>

<p>On <strong>Android</strong>, a Java wrapper application directory and AndroidManifest.xml 
file is created (see fips/cmake/fips_android.cmake).</p>

<p>On <strong>PNaCl</strong>, a manifest (.nmf) and a HTML file is generated, and the PNaCl 
finalizer tool is run as post-build-step (see fips/cmake/fips_pnacl.cmake).</p>

<p>On <strong>iOS</strong>, a .plist file is generated (see fips/cmake/fips_osx.cmake).</p>


  </article>

</div>

    </div>

  </body>

</html>
